@if (isLoading()) {
  <div class="loading-container">
    <div class="spinner-wrapper">
      <div class="spinner">
        <div class="spinner-inner"></div>
      </div>
      <div class="loading-text">
        <h2>Cargando men√∫</h2>
        <p>Preparando los mejores platos...</p>
      </div>
    </div>
  </div>
}

@if (!isLoading() && restaurant()) {
  <div class="menu-container">
    <!-- Header del restaurante -->
    <header class="restaurant-header">
      <div class="header-overlay"></div>
      <img [src]="restaurant()!.bannerUrl" alt="Banner" class="header-banner" />
      <div class="header-content">
        @if (restaurant()!.logoUrl) {
          <img [src]="restaurant()!.logoUrl" alt="Logo" class="restaurant-logo" />
        }
        <h1 class="restaurant-name">{{ restaurant()!.name }}</h1>
        @if (restaurant()!.description) {
          <p class="restaurant-description">{{ restaurant()!.description }}</p>
        }
      </div>
    </header>

    <!-- Navegaci√≥n de categor√≠as -->
    <nav class="categories-nav">
      <div class="categories-scroll">
        <button
          class="category-btn"
          [class.active]="selectedCategory() === 'all'"
          (click)="selectCategory('all')">
          <span class="category-icon">üç¥</span>
          <span class="category-name">Todos</span>
        </button>
        @for (category of menu()?.categories; track category.id) {
          <button
            class="category-btn"
            [class.active]="selectedCategory() === category.id"
            (click)="selectCategory(category.id)">
            <span class="category-icon">{{ category.icon }}</span>
            <span class="category-name">{{ category.name }}</span>
          </button>
        }
      </div>
    </nav>

    <!-- Contenido del men√∫ -->
    <main class="menu-content">
      @if (selectedCategory() === 'all') {
        <div class="all-items-header">
          <h2 class="section-title">Nuestra Carta Completa</h2>
          <p class="section-subtitle">Explora todos nuestros platos o filtra por categor√≠a</p>
        </div>
      } @else {
        @for (category of menu()?.categories; track category.id) {
          @if (selectedCategory() === category.id) {
            <div class="category-header">
              <h2 class="category-title">{{ category.name }}</h2>
              @if (category.description) {
                <p class="category-description">{{ category.description }}</p>
              }
            </div>
          }
        }
      }

      <div class="menu-items">
        @for (item of getFilteredItems(); track item.id; let idx = $index) {
          <article class="menu-item" [style.animation-delay.s]="idx * 0.05">
            @if (selectedCategory() === 'all') {
              <div class="item-category-badge">{{ getCategoryName(item.categoryId) }}</div>
            }
            @if (item.imageUrl) {
              <div class="item-image-container">
                <img [src]="item.imageUrl" [alt]="item.name" class="item-image" loading="lazy" />
                @if (item.tags && item.tags.length > 0) {
                  <div class="item-badges">
                    @for (tag of item.tags; track tag) {
                      <span class="badge">{{ tag }}</span>
                    }
                  </div>
                }
              </div>
            }
            
            <div class="item-content">
              <div class="item-header">
                <h3 class="item-name">{{ item.name }}</h3>
                <div class="item-icons">
                  @for (icon of getDietaryIcons(item); track icon) {
                    <span class="dietary-icon" [title]="icon === 'ü•¨' ? 'Vegetariano' : icon === 'üå±' ? 'Vegano' : 'Sin gluten'">{{ icon }}</span>
                  }
                  @if (item.spicyLevel && item.spicyLevel > 0) {
                    <span class="spicy-indicator">{{ getSpicyIndicator(item.spicyLevel) }}</span>
                  }
                </div>
              </div>
              
              @if (item.description) {
                <p class="item-description">{{ item.description }}</p>
              }
              
              <div class="item-footer">
                <div class="item-meta">
                  @if (item.preparationTime) {
                    <span class="prep-time">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                      </svg>
                      {{ item.preparationTime }} min
                    </span>
                  }
                  @if (item.allergens && item.allergens.length > 0) {
                    <span class="allergens">Al√©rgenos: {{ item.allergens.join(', ') }}</span>
                  }
                </div>
                <span class="item-price">{{ item.price.toFixed(2) }}‚Ç¨</span>
              </div>
            </div>
          </article>
        }
      </div>
    </main>

    <!-- Footer -->
    <footer class="menu-footer">
      <div class="footer-content">
        @if (restaurant()!.contact.address) {
          <div class="footer-item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg>
            <span>{{ restaurant()!.contact.address }}</span>
          </div>
        }
        @if (restaurant()!.contact.phone) {
          <div class="footer-item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
            </svg>
            <a [href]="'tel:' + restaurant()!.contact.phone">{{ restaurant()!.contact.phone }}</a>
          </div>
        }
        @if (restaurant()!.contact.socialMedia?.instagram) {
          <div class="footer-socials">
            <a [href]="'https://instagram.com/' + restaurant()!.contact.socialMedia!.instagram" target="_blank" class="social-link">
              {{ restaurant()!.contact.socialMedia!.instagram }}
            </a>
          </div>
        }
      </div>
    </footer>
  </div>
}
